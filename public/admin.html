<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin</title></head>
<body>
  <h2>Admin</h2>
  <p>Log in with the admin account you seeded via environment variables.</p>

  <h3>Create Competition</h3>
  <input id="title" placeholder="Title"><br>
  <input id="desc" placeholder="Description"><br>
  <input id="img" placeholder="Image URL (optional)"><br>
  <label>Total tickets:</label> <input id="total" type="number" value="200000"><br>
  <label>Price (pence):</label> <input id="price" type="number" value="25"><br>
  <label>Instant win count:</label> <input id="wins" type="number" value="100"><br>
  <button onclick="createComp()">Create</button>

  <h3>Close Competition</h3>
  <input id="closeId" type="number" placeholder="Competition ID">
  <button onclick="closeComp()">Close</button>

<script>
async function createComp(){
  const body = {
    title:val('title'), description:val('desc'), image_url:val('img'),
    total_tickets:int('total'), price_pence:int('price'), instant_win_count:int('wins')
  };
  const r = await fetch('/api/admin/competitions',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  if(r.ok) alert('Created'); else alert('Failed (are you logged in as admin?)');
}
async function closeComp(){
  const id = document.getElementById('closeId').value;
  const r = await fetch('/api/admin/competitions/'+id+'/close',{method:'POST'});
  if(r.ok) alert('Closed'); else alert('Failed');
}
function val(id){return document.getElementById(id).value}
function int(id){return parseInt(val(id),10)}
</script>
</body>
</html>
